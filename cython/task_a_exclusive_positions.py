# -*- coding: utf-8 -*-
# -----------------------------------------------------------------------------
# Copyright (c) 2015, Nicolas P. Rougier, Meropi Topalidou
# Distributed under the (new) BSD License. See LICENSE.txt for more info.
# -----------------------------------------------------------------------------
"""
Task A (Guthrie et al. (2013) protocol)
=======================================

Trials:

 - n trials with random uniform sampling of cues and positions
   Reward probabilities: A=1.00, B=0.33, C=0.66, D=0.00

"""

import numpy as np
from task import Task

np.set_printoptions(threshold='nan')
class Task_A(Task):
    def setup(self, n=204):

        # Make sure count is a multiple of 6
        n = (n // 6) * 6
        self.build(n)

        # All combinations of cues or positions
        Z = np.array([[[0, 1], [0, 1]], [[0, 1], [1, 0]], [[0, 1], [0, 2]], [[0, 1], [2, 0]], [[0, 1], [0, 3]], 
                     [[0, 1], [3, 0]], [[0, 1], [1, 2]], [[0, 1], [2, 1]], [[0, 1], [1, 3]], [[0, 1], [3, 1]], 
                     [[0, 1], [2, 3]], [[0, 1], [3, 2]], [[0, 1], [0, 1]], [[0, 1], [1, 0]], [[0, 1], [1, 2]], 
                     [[0, 1], [2, 1]], [[0, 1], [1, 3]],
                     
                     [[1, 0], [0, 1]], [[1, 0], [1, 0]], [[1, 0], [0, 2]], [[1, 0], [2, 0]], [[1, 0], [0, 3]], 
                     [[1, 0], [3, 0]], [[1, 0], [1, 2]], [[1, 0], [2, 1]], [[1, 0], [1, 3]], [[1, 0], [3, 1]], 
                     [[1, 0], [2, 3]], [[1, 0], [3, 2]], [[1, 0],[1,0]], [[1, 0], [1, 0]], [[1, 0], [1, 2]], 
                     [[1, 0], [2, 1]], [[1, 0], [1, 3]],
                     
                     [[0, 2], [0, 1]], [[0, 2], [1, 0]], [[0, 2], [0, 2]], [[0, 2], [2, 0]], [[0, 2], [0, 3]], 
                     [[0, 2], [3, 0]], [[0, 2], [1, 2]], [[0, 2], [2, 1]], [[0, 2], [1, 3]], [[0, 2], [3, 1]], 
                     [[0, 2], [2, 3]], [[0, 2], [3, 2]], [[0, 2], [0, 2]], [[0, 2], [1, 0]], [[0, 2], [1, 2]], 
                     [[0, 2], [2, 1]], [[0, 2], [1, 3]],
                     
                     [[2, 0], [0, 1]], [[2, 0], [1, 0]], [[2, 0], [0, 2]], [[2, 0], [2, 0]], [[2, 0], [0, 3]], 
                     [[2, 0], [3, 0]], [[2, 0], [1, 2]], [[2, 0], [2, 1]], [[2, 0], [1, 3]], [[2, 0], [3, 1]], 
                     [[2, 0], [2, 3]], [[2, 0], [3, 2]], [[2, 0], [2, 0]], [[2, 0], [1, 0]], [[2, 0], [1, 2]], 
                     [[2, 0], [2, 1]], [[2, 0], [1, 3]],
                     
                     [[0, 3], [0, 1]], [[0, 3], [1, 0]], [[0, 3], [0, 2]], [[0, 3], [2, 0]], [[0, 3], [0, 3]], 
                     [[0, 3], [3, 0]], [[0, 3], [1, 2]], [[0, 3], [2, 1]], [[0, 3], [1, 3]], [[0, 3], [3, 1]], 
                     [[0, 3], [2, 3]], [[0, 3], [3, 2]], [[0, 3], [0, 3]], [[0, 3], [1, 0]], [[0, 3], [1, 2]], 
                     [[0, 3], [2, 1]], [[0, 3], [1, 3]],
                     
                     [[3, 0], [0, 1]], [[3, 0], [1, 0]], [[3, 0], [0, 2]], [[3, 0], [2, 0]], [[3, 0], [0, 3]], 
                     [[3, 0], [3, 0]], [[3, 0], [1, 2]], [[3, 0], [2, 1]], [[3, 0], [1, 3]], [[3, 0], [3, 1]], 
                     [[3, 0], [2, 3]], [[3, 0], [3, 2]], [[3, 0], [3, 0]], [[3, 0], [1, 0]], [[3, 0], [1, 2]], 
                     [[3, 0], [2, 1]], [[3, 0], [1, 3]],
                     
                     [[1, 2], [0, 1]], [[1, 2], [1, 0]], [[1, 2], [0, 2]], [[1, 2], [2, 0]], [[1, 2], [0, 3]], 
                     [[1, 2], [3, 0]], [[1, 2], [1, 2]], [[1, 2], [2, 1]], [[1, 2], [1, 3]], [[1, 2], [3, 1]], 
                     [[1, 2], [2, 3]], [[1, 2], [3, 2]], [[1, 2], [1, 2]], [[1, 2], [1, 0]], [[1, 2], [1, 2]], 
                     [[1, 2], [2, 1]], [[1, 2], [1, 3]],
                                          
                     [[2, 1], [2, 1]], [[2, 1], [1, 0]], [[2, 1], [0, 2]], [[2, 1], [2, 0]], [[2, 1], [0, 3]], 
                     [[2, 1], [3, 0]], [[2, 1], [1, 2]], [[2, 1], [2, 1]], [[2, 1], [1, 3]], [[2, 1], [3, 1]], 
                     [[2, 1], [2, 3]], [[2, 1], [3, 2]], [[0, 1], [2, 1]], [[2, 1], [1, 0]], [[2, 1], [1, 2]], 
                     [[2, 1], [2, 1]], [[2, 1], [1, 3]],
                     
                     [[1, 3], [0, 1]], [[1, 3], [1, 0]], [[1, 3], [0, 2]], [[1, 3], [2, 0]], [[1, 3], [0, 3]], 
                     [[1, 3], [3, 0]], [[1, 3], [1, 2]], [[1, 3], [2, 1]], [[1, 3], [1, 3]], [[1, 3], [3, 1]], 
                     [[1, 3], [2, 3]], [[1, 3], [3, 2]], [[1, 3], [1, 3]], [[1, 3], [1, 0]], [[1, 3], [1, 2]], 
                     [[1, 3], [2, 1]], [[1, 3], [1, 3]],
                     
                     [[3, 1], [0, 1]], [[3, 1], [1, 0]], [[3, 1], [0, 2]], [[3, 1], [2, 0]], [[3, 1], [0, 3]], 
                     [[3, 1], [3, 0]], [[3, 1], [1, 2]], [[3, 1], [2, 1]], [[3, 1], [1, 3]], [[3, 1], [3, 1]], 
                     [[3, 1], [2, 3]], [[3, 1], [3, 2]], [[3, 1], [3, 1]], [[3, 1], [1, 0]], [[3, 1], [1, 2]], 
                     [[3, 1], [2, 1]], [[3, 1], [1, 3]],
                      
                     [[2, 3], [0, 1]], [[2, 3], [1, 0]], [[2, 3], [0, 2]], [[2, 3], [2, 0]], [[2, 3], [0, 3]], 
                     [[2, 3], [3, 0]], [[2, 3], [1, 2]], [[2, 3], [2, 1]], [[2, 3], [1, 3]], [[2, 3], [3, 1]], 
                     [[2, 3], [2, 3]], [[2, 3], [3, 2]], [[2, 3], [2, 3]], [[2, 3], [1, 0]], [[2, 3], [1, 2]], 
                     [[2, 3], [2, 1]], [[2, 3], [1, 3]],
                      
                     [[3, 2], [0, 1]], [[3, 2], [1, 0]], [[3, 2], [0, 2]], [[3, 2], [2, 0]], [[3, 2], [0, 3]], 
                     [[3, 2], [3, 0]], [[3, 2], [1, 2]], [[3, 2], [2, 1]], [[3, 2], [1, 3]], [[3, 2], [3, 1]], 
                     [[3, 2], [2, 3]], [[3, 2], [3, 2]], [[3, 2], [3, 2]], [[3, 2], [1, 0]], [[3, 2], [1, 2]], 
                     [[3, 2], [2, 1]], [[3, 2], [1, 3]]])

        # n//6 x all combinations of positions
        M = np.repeat(np.arange(204), n // 204)
        np.random.shuffle(M)
        temp = Z[M]
        cog = temp[:,0]
        mot = temp[:,1]

        for i in range(n):
            c1, c2 = cog[i]
            m1, m2 = mot[i]
            trial = self.trials[i]

            trial["cog"][[c1, c2]] += 1
            trial["mot"][[m1, m2]] += 1
            trial["ass"][m1, c1] += 1
            trial["ass"][m2, c2] += 1
            trial["rwd"][...] = 1.00, 0.66, 0.33, 0.00

if __name__ == "__main__":
    task = Task_A(n=408)
    print task.trials["cog"]
    print task.trials["mot"]